<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Форум через GitHub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .issue-card { transition: transform 0.2s; }
        .issue-card:hover { transform: translateY(-3px); }
        .loader { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="text-center mb-4">
            <h1>Форум сообщества</h1>
            <div class="btn-group">
                <button class="btn btn-outline-primary active" onclick="showTab('issues')">Обсуждения</button>
                <button class="btn btn-outline-primary" onclick="showTab('discussions')">Q&A</button>
            </div>
        </div>

        <!-- Контент Issues -->
        <div id="issues-tab">
            <a href="https://github.com/lifedestroyed/forum/issues/new" 
               class="btn btn-success mb-3" 
               target="_blank">
                Создать новую тему
            </a>
            <div id="issues-list" class="row g-3"></div>
        </div>

        <!-- Контент Discussions -->
        <div id="discussions-tab" style="display: none;">
            <a href="https://github.com/lifedestroyed/forum/discussions/new" 
               class="btn btn-success mb-3" 
               target="_blank">
                Задать вопрос
            </a>
            <div id="discussions-list" class="row g-3"></div>
        </div>

        <!-- Лоадер -->
        <div id="loader" class="text-center mt-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Загрузка...</span>
            </div>
        </div>
    </div>

    <script>
        // Конфигурация
        const CONFIG = {
            repoOwner: 'lifedestroyed',
            repoName: 'forum',
            issuesApi: 'https://api.github.com/repos/{owner}/{repo}/issues',
            discussionsApi: 'https://api.github.com/graphql'
        };

        // Показать таб
        function showTab(tabName) {
            document.querySelectorAll('[id$="-tab"]').forEach(tab => 
                tab.style.display = 'none');
            document.getElementById(`${tabName}-tab`).style.display = 'block';
            
            if(tabName === 'issues') loadIssues();
            if(tabName === 'discussions') loadDiscussions();
        }

        // Загрузить Issues
        async function loadIssues() {
            try {
                const url = CONFIG.issuesApi
                    .replace('{owner}', CONFIG.repoOwner)
                    .replace('{repo}', CONFIG.repoName);
                
                const response = await fetch(url);
                const issues = await response.json();
                
                renderIssues(issues.filter(issue => !issue.pull_request));
            } catch (error) {
                console.error('Ошибка:', error);
            }
        }

        // Загрузить Discussions
        async function loadDiscussions() {
            try {
                const query = `
                    query {
                        repository(owner: "${CONFIG.repoOwner}", name: "${CONFIG.repoName}") {
                            discussions(first: 20) {
                                nodes {
                                    title
                                    url
                                    createdAt
                                    author { login }
                                    comments { totalCount }
                                }
                            }
                        }
                    }
                `;

                const response = await fetch(CONFIG.discussionsApi, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer 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',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query })
                });
                
                const { data } = await response.json();
                renderDiscussions(data.repository.discussions.nodes);
            } catch (error) {
                console.error('Ошибка:', error);
            }
        }

        // Рендер Issues
        function renderIssues(issues) {
            const container = document.getElementById('issues-list');
            container.innerHTML = issues.map(issue => `
                <div class="col-md-6">
                    <div class="card issue-card mb-3">
                        <div class="card-body">
                            <h5 class="card-title">${issue.title}</h5>
                            <p class="text-muted">Автор: ${issue.user.login}</p>
                            <a href="${issue.html_url}" 
                               target="_blank" 
                               class="btn btn-outline-primary">
                                Перейти к обсуждению (${issue.comments} комментариев)
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Рендер Discussions
        function renderDiscussions(discussions) {
            const container = document.getElementById('discussions-list');
            container.innerHTML = discussions.map(discussion => `
                <div class="col-md-6">
                    <div class="card issue-card mb-3">
                        <div class="card-body">
                            <h5 class="card-title">${discussion.title}</h5>
                            <p class="text-muted">Автор: ${discussion.author.login}</p>
                            <a href="${discussion.url}" 
                               target="_blank" 
                               class="btn btn-outline-primary">
                                Ответов: ${discussion.comments.totalCount}
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Инициализация
        window.onload = () => {
            loadIssues();
            document.getElementById('loader').style.display = 'none';
        };
    </script>
</body>
</html>